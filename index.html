<!DOCTYPE html>
<!-- Built with spec-md https://spec-md.com -->
<html>
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"><title>KTex</title>
<style>@media (prefers-color-scheme: light){:root{--color-foreground: #333333;--color-background: #ffffff;--color-light-grey: #ccc;--color-grey: #666666;--color-white: #fff;--color-link: #3b5998;--color-subsection-link: var(--color-foreground);--color-toc-link: var(--color-foreground);--color-toc-id: var(--color-link);--color-toggle-border: #bbc;--color-sidebar-background: #f0f0f0;--color-sidebar-viewing-link: #8b9;--color-sidebar-toggle-button: rgba(0, 0, 0, .7);--color-sidebar-shadow-inset: rgba(0, 0, 0, .05);--color-sidebar-shadow: rgba(0, 0, 0, .04);--color-sidebar-large-shadow: rgba(0, 0, 0, .08);--color-pre-background: #fafafa;--color-pre-border: #e9e9e9;--color-code-background: rgba(0, 0, 0, .03);--color-spec-todo: var(--color-grey);--color-spec-example: #fafaff;--color-spec-example-border: #bbbbff;--color-spec-counter-example: #fffafa;--color-spec-counter-border: #ffbbbb;--color-spec-counter-example-link: #98593b;--color-spec-added-border: #396;--color-spec-removed-border: #933;--color-spec-prose: var(--color-grey);--color-spec-quantifier-list: var(--color-link);--color-spec-quantifier-optional: #83238e;--color-spec-condition: #1c7758;--color-spec-param: var(--color-grey);--color-spec-rx: var(--color-foreground);--color-spec-note-border: #f4e925;--color-spec-note-background: #fefef3;--color-spec-note-first-link: #6c6613;--color-source-link: var(--color-light-grey);--color-table-header: #f9f9f9;--color-table-header-border: #d0d0d0;--color-token-inserted: hsla(241, 71%, 34%, .69);--color-token-deleted: hsla(324, 92%, 33%, .74);--color-inserts-background: rgba(0, 200, 30, .08);--color-deletions-background: rgba(200, 0, 0, .08);--selection-background-color: #cacee0;--selection-background-color-link: #f0babe}.selection-link:hover{--selection-background-color: #3b5998}}@media (prefers-color-scheme: dark){:root{--color-foreground: #b6b6b6;--color-background: #262626;--color-light-grey: #373737;--color-grey: #828282;--color-white: rgb(29, 29, 29);--color-link: #89b7da;--color-subsection-link: var(--color-foreground);--color-toc-link: var(--color-foreground);--color-toc-id: var(--color-link);--color-toggle-border: #bbc;--color-sidebar-background: #323232;--color-sidebar-viewing-link: #8b9;--color-sidebar-toggle-button: rgba(220, 220, 220, .7);--color-sidebar-shadow-inset: rgba(0, 0, 0, .05);--color-sidebar-shadow: rgba(0, 0, 0, .04);--color-sidebar-large-shadow: rgba(0, 0, 0, .08);--color-pre-background: #2e2e2e;--color-pre-border: #3a3a3a;--color-code-background: rgba(41, 41, 41, .03);--color-spec-todo: var(--color-grey);--color-spec-example: #2b2b35;--color-spec-example-border: #4d4d6d;--color-spec-counter-example: #322828;--color-spec-counter-border: #664040;--color-spec-counter-example-link: #ff702d;--color-spec-added-border: #396;--color-spec-removed-border: #933;--color-spec-prose: var(--color-grey);--color-spec-quantifier-list: var(--color-link);--color-spec-quantifier-optional: #c689ce;--color-spec-condition: #6fa889;--color-spec-param: var(--color-grey);--color-spec-rx: var(--color-foreground);--color-spec-note-border: #605e39;--color-spec-note-background: #303028;--color-spec-note-first-link: #f0e330;--color-source-link: var(--color-grey);--color-table-header: #373737;--color-table-header-border: #525252;--color-token-inserted: hsla(241, 63%, 70%, .69);--color-token-deleted: hsla(325, 64%, 67%, .74);--color-inserts-background: rgba(0, 200, 30, .08);--color-deletions-background: rgba(200, 0, 0, .08);--selection-background-color: #656565;--selection-background-color-link: #f0babe}.selection-link:hover{--selection-background-color: #829edb}}:root{color:var(--color-foreground);background-color:var(--color-background);font-family:var(--font-family);font-size:15px;line-height:1.5;--mono-font-size: 13px;--indent: 1rem;--list-indent: 1.5rem;--dfn-indent: 0rem;--font-family: Cambria, "Palatino Linotype", Palatino, "Liberation Serif", serif;--font-family-monospace: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace}@media (min-width: 720px){:root{font-size:17px;--mono-font-size: 15px;--indent: 2rem;--list-indent: 2rem;--dfn-indent: 2rem}}body{margin:3rem 0 3rem}article{margin:0 1rem}@media (min-width: 720px){body{margin:6rem auto 3rem;max-width:800px;padding-left:75px;padding-right:clamp(0px,calc((100vw - 800px) * .25),75px)}}.source-link{display:none}@media screen and (min-width: 720px){.source-link{display:block;position:absolute;width:18px;fill:var(--color-source-link);opacity:.3}.source-link:hover{opacity:1}}.outdated-selection-link,.selection-link{position:absolute;display:block;color:var(--color-white);background:var(--selection-background-color);border-radius:4px;font-size:36px;height:23px;line-height:48px;text-align:center;text-decoration:none;width:25px;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.outdated-selection-link:hover,.selection-link:hover{text-decoration:none}.outdated-selection-link:before,.selection-link:before{border:5px solid transparent;content:"";height:0;margin-top:-5px;margin-right:-5px;position:absolute;right:1px;top:50%;width:0}@media (max-width: 719px){.outdated-selection-link:before,.selection-link:before{border-bottom-color:var(--selection-background-color);border-top:0;right:50%;top:1px}}@media (min-width: 720px){.outdated-selection-link:before,.selection-link:before{border-left-color:var(--selection-background-color);border-right:0;right:1px;top:50%}}.outdated-selection-link{background:var(--selection-background-color-link);font-size:21px;font-weight:800;line-height:27px}.outdated-selection-link:hover:after{content:"This selection content has changed since this link was created.";font:9pt/11pt var(--font-family);position:absolute;display:block;white-space:nowrap;padding:2px 5px 1px;top:-20px;background:black;color:var(--color-white)}a{color:var(--color-link);text-decoration:none}a:hover{text-decoration:underline}img{max-width:100%}dl{margin:1rem 0 1rem var(--dfn-indent)}dd{margin:.25em 0 .5em var(--indent)}dd+dd{margin-top:1rem}dfn,.spec-ref{font-style:italic}dfn>a,.spec-ref>a{color:inherit}h1,h2,h3,h4,h5,h6{font-weight:bold;margin:3em 0 1em;position:relative}@media (min-width: 720px){header>h1{margin:6em 0 3em}}h1{font-size:1.5em;margin-top:5em}h2,h3{font-size:1.25em}h4,h5,h6{font-size:1em}section{padding-top:1rem;margin-top:-1rem}section.subsec>h6{margin-top:2em}section.subsec>h6>a{color:var(--color-subsection-link)}section .spec-secid{margin-right:1ex}@media (min-width: 720px){section .spec-secid{position:absolute;right:100%;text-align:right;white-space:nowrap}}footer{font-size:75%;opacity:.5;text-align:center;margin-top:12rem}.spec-toc{margin:1rem 0 3rem}.spec-toc .title{content:"Contents";display:block;font-weight:bold;margin:5em 0 1em}.spec-toc .spec-secid{margin-right:1ex}.spec-toc ol{list-style:none;padding-left:0;margin-top:0;margin-bottom:0}.spec-toc ol ol{list-style:none;padding-left:2ex;margin-bottom:.25em}.spec-toc li{position:relative;padding:5px 0 0 30px;margin:-5px 0 0 -30px}.spec-toc a{color:var(--color-toc-link)}.spec-toc a:hover{text-decoration:none}.spec-toc a .spec-secid{color:var(--color-toc-id)}.spec-toc a:hover .spec-secid{text-decoration:underline}.spec-toc .toggle{display:none}.spec-toc .toggle+label{cursor:pointer;left:6px;opacity:1;padding:5px 6px 5px 7px;position:absolute;top:6px;transform:rotate(0deg);transition:all .18s ease-in-out}.spec-toc .toggle+label:after{border-color:transparent transparent transparent var(--color-toggle-border);border-style:solid;border-width:6px 0 6px 7px;content:" ";display:block;height:0;width:0}@media (pointer: fine){.spec-toc .toggle+label{left:10px;padding:3px 5px 3px 6px;top:8px}}.spec-toc .toggle:checked+label{transform:rotate(90deg)}@media (hover: hover){.spec-toc li:not(:hover)>.toggle:checked+label{opacity:0}}.spec-toc .toggle:not(:checked)~ol{max-height:0;overflow:hidden;margin:0}.spec-sidebar-toggle{display:none}.spec-sidebar-toggle+label>.spec-sidebar-button{position:fixed;right:0;top:0;padding:10px 15px;font-size:30px;color:var(--color-sidebar-toggle-button);z-index:2;cursor:pointer;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.spec-sidebar-toggle:checked+label:after{content:"";position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0}.spec-sidebar{display:none;position:fixed;right:0;top:0;width:min(320px,calc(100vw - 48px));font-size:14px;line-height:1.75;overflow-y:scroll;height:100%;padding:0 0 5rem 30px;box-sizing:border-box;background:var(--color-sidebar-background);box-shadow:inset 1px 0 var(--color-sidebar-shadow-inset),-4px 0 8px -2px var(--color-sidebar-shadow);overscroll-behavior:contain}.spec-sidebar{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.spec-sidebar-toggle:checked~.spec-sidebar{display:block}.spec-sidebar .viewing>a:after{color:var(--color-sidebar-viewing-link);content:"\2022";margin-left:1ex}@media (min-width: 1220px){.spec-sidebar-toggle+label{display:none}.spec-sidebar{display:block;box-shadow:inset 1px 0 var(--color-sidebar-shadow-inset),inset 4px 0 8px -2px var(--color-sidebar-large-shadow)!important}body{padding-right:345px}}.spec-note{background:var(--color-spec-note-background);border-left:solid 4px var(--color-spec-note-border);margin:1rem -1rem;min-width:70vw;padding:8px 1rem 12px calc(1rem - 4px);width:-moz-fit-content;width:-webkit-fit-content;width:fit-content}@media (min-width: 720px){.spec-note{min-width:416px}}.spec-note>a:first-child{color:var(--color-spec-note-first-link);display:block;font:italic 11pt/18pt var(--font-family);opacity:.6;user-select:none}.spec-todo{color:var(--color-spec-todo);margin:1em 0 1em 5em;min-height:1em}.spec-todo::before{content:"todo";display:block;float:left;margin-left:-5em;text-transform:uppercase}.spec-index ol{list-style-type:none;margin:0 0 0 var(--indent);padding:0;column-width:210px;column-gap:var(--indent)}.spec-index ol li{width:min-content;white-space:nowrap}pre,code{font-family:var(--font-family-monospace);font-size:var(--mono-font-size);font-weight:inherit}code{background:var(--color-code-background);margin:-2px -1px;padding:3px 3px;white-space:pre-wrap}pre>code{background:none;font-weight:inherit;margin:0;padding:0;white-space:pre}pre{background:var(--color-pre-background);border-left:solid 4px var(--color-pre-border);margin:1rem -1rem;min-width:70vw;padding:12px 1rem 12px calc(1rem - 4px);width:-moz-fit-content;width:-webkit-fit-content;width:fit-content;max-width:calc(100vw - 2rem);overflow-y:auto}@media (min-width: 720px){pre{min-width:40ch}}.spec-example{background:var(--color-spec-example);border-left:solid 4px var(--color-spec-example-border);padding-top:8px}.spec-counter-example{background:var(--color-spec-counter-example);border-left:solid 4px var(--color-spec-counter-border);padding-top:8px}.spec-example>a,.spec-counter-example>a{display:block;font:italic 11pt/18pt var(--font-family);opacity:.6;user-select:none}.spec-counter-example>a{color:var(--color-spec-counter-example-link)}table{border-collapse:collapse}th{background-color:var(--color-table-header)}td,th{border:1px solid var(--color-table-header-border);padding:.4em;vertical-align:baseline}ol,ul{padding-left:var(--list-indent)}li>ol,li>ul{margin-top:.25em;margin-bottom:.5em}li+li{margin-top:.25em}li.task{list-style-type:none;position:relative}li.task>input:first-child{margin-left:0;position:absolute;transform:translateX(calc(-100% - 1ch))}ins{background-color:var(--color-inserts-background);text-decoration:none}del{background-color:var(--color-deletions-background)}.spec-added,.spec-removed{border-left:4px solid;margin-left:-18px;padding-left:14px}.spec-added{border-color:var(--color-spec-added-border)}.spec-removed{border-color:var(--color-spec-removed-border);text-decoration:line-through}.spec-keyword{font-weight:bold}.spec-string{font-family:var(--font-family-monospace);font-size:85%;white-space:pre}var{font-style:italic}*[data-name]{transition:.15s background ease-out;border-radius:2px;padding:0 3px;margin:0 -3px}.spec-semantic,.spec-algo{margin:1rem 0 1rem var(--dfn-indent)}.spec-semantic>.spec-nt::after,.spec-algo>.spec-call:first-child::after{content:":";font-style:normal;font-weight:bold;margin-left:1ex}.spec-semantic ol,.spec-semantic ol ol ol ol,.spec-algo ol,.spec-algo ol ol ol ol{list-style-type:decimal}.spec-semantic ol ol,.spec-semantic ol ol ol ol ol,.spec-algo ol ol,.spec-algo ol ol ol ol ol{list-style-type:lower-alpha}.spec-semantic ol ol ol,.spec-semantic ol ol ol ol ol ol,.spec-algo ol ol ol,.spec-algo ol ol ol ol ol ol{list-style-type:lower-roman}.spec-call>a{color:inherit}.spec-production{margin:1rem 0 1rem var(--dfn-indent)}.spec-production>.spec-nt::after{content:":";font-style:normal;font-weight:bold;margin:0 1ex}.spec-semantic.d2>.spec-nt::after,.spec-production.d2>.spec-nt::after{content:"::"}.spec-semantic.d3>.spec-nt::after,.spec-production.d3>.spec-nt::after{content:":::"}.spec-production>.spec-rhs{line-height:1.1;margin:.25em 0 .5em calc(2 * var(--indent));text-indent:calc(-1 * var(--indent))}.spec-semantic>.spec-rhs{display:inline-block;text-indent:calc(-1 * var(--indent));margin-left:calc(1ex + var(--indent))}.spec-rhs>*{text-indent:0}.spec-oneof{display:inline}.spec-oneof::before{content:"one of";font-style:normal;font-weight:bold}.spec-oneof-grid{max-width:calc(100vw - 2rem);overflow:auto;margin:-1ex -1rem;padding:1ex 1rem}.spec-oneof-grid>table{margin-left:var(--indent)}.spec-oneof .spec-rhs{border:none;margin:0;padding:0 0 0 1rem;vertical-align:baseline;white-space:pre}.spec-oneof .spec-rhs:first-child{padding:0}.spec-rhs .spec-constrained:not(:first-child),.spec-rhs .spec-quantified:not(:first-child),.spec-rhs .spec-nt:not(:first-child),.spec-rhs .spec-t:not(:first-child),.spec-rhs .spec-rx:not(:first-child),.spec-rhs .spec-prose:not(:first-child),.spec-rhs .spec-empty:not(:first-child),.spec-rhs .spec-lookahead:not(:first-child){margin-left:1ex;display:inline-block}.spec-condition{font-size:85%}.spec-condition::before{content:"[if "}.spec-condition.not::before{content:"[if not "}.spec-condition::after{content:"]"}.spec-empty,.spec-prose{color:var(--color-spec-prose)}.spec-nt{font-style:italic}.spec-nt>a{color:inherit}.spec-quantifiers,.spec-params{font-size:65%;font-style:normal;vertical-align:sub}.spec-quantifier.list{color:var(--color-spec-quantifier-list)}.spec-quantifier.optional{color:var(--color-spec-quantifier-optional)}.spec-params,.spec-condition{color:var(--color-spec-condition)}.spec-params::before{content:"["}.spec-params::after{content:"]"}.spec-quantifier:not(:last-child)::after,.spec-param:not(:last-child)::after{color:var(--color-spec-param);content:", "}.spec-param.conditional::before{content:"?"}.spec-param.negated::before{content:"!"}.spec-t,.spec-rx{color:var(--color-spec-rx);font-family:var(--font-family-monospace);font-weight:bold}.spec-butnot::before{color:var(--color-grey);content:"but not";font-family:var(--font-family);font-weight:normal;margin-right:1ex}.spec-butnot>*:not(:first-child)::before{color:var(--color-grey);content:"or";font-family:var(--font-family);font-weight:normal;margin-right:1ex}.spec-rhs .spec-oneof::before,.spec-rhs .spec-butnot::before{margin-left:1ex}.spec-lookahead>*{margin:0!important}.spec-lookahead>*:not(:first-child)::before{color:var(--color-grey);content:", ";font-family:var(--font-family);font-style:normal;font-weight:normal}.spec-lookahead::before{color:var(--color-grey);content:"[lookahead = ";font-family:var(--font-family);font-style:normal;font-weight:normal}.spec-lookahead.not::before{content:"[lookahead \2260  "}.spec-lookahead.set::before{content:"[lookahead \2208  {";margin-right:0}.spec-lookahead.set.not::before{content:"[lookahead \2209  {"}.spec-lookahead.ntset::before{content:"[lookahead \2208  ";margin-right:0}.spec-lookahead.ntset.not::before{content:"[lookahead \2209  "}.spec-lookahead::after{color:var(--color-grey);content:"]"}.spec-lookahead.set::after{content:"}]"}code[class*=language-],pre[class*=language-]{color:var(--color-prism-foreground);background:none;text-shadow:0 1px var(--color-prism-text-shadow);font-family:var(--font-family-monospace);font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection{text-shadow:none;background:var(--color-prism-background)}pre[class*=language-]::selection,pre[class*=language-] ::selection,code[class*=language-]::selection,code[class*=language-] ::selection{text-shadow:none;background:var(--color-prism-background)}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:var(--color-prism-block-background)}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.atrule,.token.attr-value,.token.keyword,.token.property,.token.selector,.token.attr-name,.token.builtin,.token.entity,.token.url,.token.inserted{color:var(--color-token-inserted);background:none}.token.tag,.token.boolean,.token.number,.token.string,.token.char,.token.constant,.token.symbol,.token.regex,.token.important,.token.variable,.token.function,.token.class-name,.token.deleted{color:var(--color-token-deleted)}.token.comment,.token.prolog,.token.doctype,.token.cdata,.token.description{color:inherit;opacity:.3}.token.punctuation{color:inherit;opacity:.5}.token.operator,.token.namespace{color:inherit;opacity:.7}</style>
<script>(function(){var r,a=[];document.addEventListener("readystatechange",function(){document.readyState==="interactive"&&u()});function u(){var n=document.querySelector('label[for="spec-sidebar-toggle"]');n.addEventListener("scroll",o),n.addEventListener("touchmove",o);function o(d){d.preventDefault()}for(var t=document.getElementsByTagName("section"),e=0;e<t.length;e++)t[e].getAttribute("secid")&&a.push(t[e]);var i=window.scrollY,c=!1;window.addEventListener("scroll",function(d){i=window.scrollY,c||(c=!0,window.requestAnimationFrame(function(){s(i),c=!1}))})}function s(n){for(var o=n+document.documentElement.clientHeight/4,t,e=a.length-1;e>=0;e--)if(a[e].offsetTop<o){t=a[e];break}var i=t&&t.getAttribute("secid");i!==r&&(r&&l(r,!1),i&&l(i,!0),r=i)}function l(n,o){document.getElementById("_sidebar_"+n).className=o?"viewing":"";for(var t=n.split(".");t.length;){var e=document.getElementById("_toggle_"+t.join("."));e&&(e.checked=o),t.pop()}}s(window.scrollY);})();</script>
<script>(function(){var n=document.getElementsByTagName("style")[0].sheet,e;function u(){e&&(n.deleteRule(e),e=void 0)}function d(t){u(),e=n.insertRule('*[data-name="'+t+'"] { background: rgba(230,215,0,0.12); }',n.cssRules.length)}document.documentElement.addEventListener("mouseover",function(t){var a=t.target.attributes["data-name"];a&&d(a.value)});document.documentElement.addEventListener("mouseout",u);})();</script>
<script>(function(){var R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",o,p,r,g;document.addEventListener("selectionchange",E);window.addEventListener("resize",C);window.addEventListener("hashchange",x);window.addEventListener("load",x);function S(n){y(new URL(n.target.href))}function x(){y(window.location)}function y(n){var e=n.hash.match(/^#sel-([A-Za-z0-9-_]+)$/);if(!!e){g=e[1],r=k(g);var t=r.getBoundingClientRect(),d=Math.max(20,Math.floor((window.innerHeight-t.height)*.4));window.scrollTo(0,window.scrollY+t.y-d);var c=document.getSelection();c.empty(),c.addRange(r),C()}}function E(n){var e=document.getSelection();if(e.isCollapsed)o&&(o.parentNode.removeChild(o),o=null);else{var t=e.getRangeAt(0);(!r||t.compareBoundaryPoints(Range.START_TO_START,r)!==0||t.compareBoundaryPoints(Range.END_TO_END,r)!==0)&&(r=t,g=B(r),C())}}function C(){if(!!r){p||(p=document.getElementsByTagName("article")[0]),o||(o=document.createElement("a"),document.body.appendChild(o)),o.href="#sel-"+g,o.onclick=S,o.className=r.isOutdated?"outdated-selection-link":"selection-link",o.innerText=r.isOutdated?"!":"\u201F";var n=window.innerWidth<720,e=r.getBoundingClientRect();if(n)o.style.left=Math.floor(e.x+e.width/2+window.scrollX-13)+"px",o.style.top=Math.floor(e.bottom+window.scrollY+10)+"px";else{var t=p.getBoundingClientRect().x;o.style.left=Math.floor(t+window.scrollX-37)+"px",o.style.top=Math.floor(e.y+window.scrollY-3)+"px"}}}function B(n){var e="",t=N(n.startContainer),d=N(n.endContainer),c=M(t,d);return l(c),l(t.slice(c.length).concat(n.startOffset)),l(d.slice(c.length).concat(n.endOffset)),i(L(n.toString())),e;function i(a){do e+=R[a&31|(a>31?32:0)],a>>=5;while(a>0)}function l(a){i(a.length);for(var h=0;h<a.length;h++)i(a[h])}}function k(n){for(var e=new Array(64),t=0;t<64;t++)e[R.charCodeAt(t)]=t;var d=0,c=m(),i=m(),l=m(),a=w(),h=i.pop(),P=O(c.concat(i)),T=l.pop(),A=O(c.concat(l)),u=document.createRange();return u.setStart(P,h),u.setEnd(A,T),u.isOutdated=a!==void 0&&a!==L(u.toString()),u;function w(){for(var s=0,v=0;d<n.length;){var f=e[n.charCodeAt(d++)];if(s|=(f&31)<<v,v+=5,f<32)return s}}function m(){var s=w();if(s!=null){for(var v=new Array(s),f=0;f<s;f++)v[f]=w();return v}}}function N(n){for(var e=[];n!=document.body;){var t=n.parentNode;e.push(Array.prototype.indexOf.call(t.childNodes,n)),n=t}return e.reverse()}function O(n){for(var e=document.body,t=0;t<n.length&&e;t++)e=e.childNodes[n[t]];return e}function M(n,e){for(var t=0;t<n.length&&t<e.length&&n[t]===e[t];)t++;return n.slice(0,t)}function L(n){for(var e=2166136261,t=0;t<n.length;++t)e^=n.charCodeAt(t),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return(e>>15^e)&32767}})();</script>
</head>
<body><article>
<header>
<h1>KTex</h1>
<section id="intro">
<p><em>Working Draft</em></p>
<section id="sec-Introduction" class="subsec">
<h6><a href="#sec-Introduction" title="link to this subsection">Introduction</a></h6>
<p>KTex is an extensible, modular markup language, designed to simplify the process of creating and publishing text across diverse domains and formats.</p>
</section>
<section id="sec-Copyright" class="subsec">
<h6><a href="#sec-Copyright" title="link to this subsection">Copyright</a></h6>
<p>Copyright 2023-present Dimitri Kurashvili <dimakura@gmail.com></p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &ldquo;Software&rdquo;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</section>
<section id="sec-Attribution" class="subsec">
<h6><a href="#sec-Attribution" title="link to this subsection">Attribution</a></h6>
<p>This specification is heavily influenced by the <a href="https://spec.graphql.org/">GraphQL</a> specifications.</p>
</section>
</section>
<nav class="spec-toc">
<div class="title">Contents</div>
<ol>
<li><a href="#sec-Overview"><span class="spec-secid">1</span>Overview</a><ol>
<li><a href="#sec-Design-Principles"><span class="spec-secid">1.1</span>Design Principles</a><ol>
<li><a href="#sec-Single-Base"><span class="spec-secid">1.1.1</span>Single Base</a></li>
<li><a href="#sec-Extensibility"><span class="spec-secid">1.1.2</span>Extensibility</a></li>
<li><a href="#sec-Modularity"><span class="spec-secid">1.1.3</span>Modularity</a></li>
<li><a href="#sec-Writing-Style"><span class="spec-secid">1.1.4</span>Writing Style</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#sec-Language"><span class="spec-secid">2</span>Language</a><ol>
<li><a href="#sec-Source-Text"><span class="spec-secid">2.1</span>Source Text</a><ol>
<li><a href="#sec-White-Space"><span class="spec-secid">2.1.1</span>White Space</a></li>
<li><a href="#sec-Line-Terminator"><span class="spec-secid">2.1.2</span>Line Terminator</a></li>
<li><a href="#sec-Comment"><span class="spec-secid">2.1.3</span>Comment</a></li>
<li><a href="#sec-Lexical-Tokens"><span class="spec-secid">2.1.4</span>Lexical Tokens</a></li>
<li><a href="#sec-Ignored-Tokens"><span class="spec-secid">2.1.5</span>Ignored Tokens</a></li>
</ol>
</li>
<li><a href="#sec-Operator"><span class="spec-secid">2.2</span>Operator</a></li>
<li><a href="#sec-Document"><span class="spec-secid">2.3</span>Document</a></li>
</ol>
</li>
<li><a href="#index"><span class="spec-secid">§</span>Index</a></li>
</ol>
</nav>
</header>
<section id="sec-Overview" secid="1">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Overview">1</a></span>Overview</h1>
<p>KTex is an extensible markup language that simplifies the process of preparing texts for publication.</p>
<section id="sec-Design-Principles" secid="1.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Design-Principles">1.1</a></span>Design Principles</h2>
<p>Before delving into the specifics, let&rsquo;s first explore the primary problems that KTex aims to resolve. These problems, in turn, help to illustrate the key features of KTex and reflect the fundamental design principles that guide its development.</p>
<section id="sec-Single-Base" secid="1.1.1">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Single-Base">1.1.1</a></span>Single Base</h3>
<p>The first problem that KTex aims to address is providing publishers with a single, reliable base to manage various publication formats, each with its unique requirements. The benefits of having a unified base for all publications are evident: it eases proofreading, guarantees uniformity across formats, and saves time and resources.</p>
</section>
<section id="sec-Extensibility" secid="1.1.2">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Extensibility">1.1.2</a></span>Extensibility</h3>
<p>Publishers frequently have specific requirements, including unique fonts, text styling, and layouts. KTex is not a fixed markup language; rather, it functions as a flexible framework that can be expanded to accommodate a wide range of needs.</p>
</section>
<section id="sec-Modularity" secid="1.1.3">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Modularity">1.1.3</a></span>Modularity</h3>
<p>KTex is modular by design. Publishers can use external modules to further enhance KTex, or develop their own modules for use across different KTex projects or for sharing with other publishers. In fact, the core of KTex is primarily a collection of modules, with only a minimal layer of immutable code.</p>
</section>
<section id="sec-Writing-Style" secid="1.1.4">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Writing-Style">1.1.4</a></span>Writing Style</h3>
<p>KTex simplifies the task of ensuring a consistent writing style across publications. For instance, if a publisher requires the use of the Oxford comma in all publications, this can be readily enforced by integrating the <code>ktex-chicago-style</code> module. This module alone offers thousands of other checks, all of which can be enabled or disabled according to preference. </p>
</section>
</section>
</section>
<section id="sec-Language" secid="2">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Language">2</a></span>Language</h1>
<p>Clients use the KTex markup language to prepare texts for publication. We refer to such texts as source documents. A document is built from a sequence of blocks, which optionally use operators to modify their content.</p>
<p>The source text of a KTex document must be a sequence of <span class="spec-nt"><a href="#SourceCharacter" data-name="SourceCharacter">SourceCharacter</a></span>s. These characters must be described by a sequence of <span class="spec-nt"><a href="#Token" data-name="Token">Token</a></span> lexical grammars. The lexical token sequence, omitting <span class="spec-nt"><a href="#Ignored" data-name="Ignored">Ignored</a></span>, must be described by a single <span class="spec-nt"><a href="#Document" data-name="Document">Document</a></span> syntactic grammar.</p>
<section id="sec-Language.Lexical-Analysis-and-Syntax-Parse" class="subsec">
<h6><a href="#sec-Language.Lexical-Analysis-and-Syntax-Parse" title="link to this subsection">Lexical Analysis and Syntax Parse</a></h6>
<p>The source text of a KTex document is first converted into a sequence of lexical tokens, <span class="spec-nt"><a href="#Token" data-name="Token">Token</a></span>, and ignored tokens, <span class="spec-nt"><a href="#Ignored" data-name="Ignored">Ignored</a></span>. The source text is scanned from left to right, repeatedly taking the next possible sequence of code-points allowed by the lexical grammar productions as the next token. This sequence of lexical tokens are then scanned from left to right to produce an abstract syntax tree (AST) according to the <span class="spec-nt"><a href="#Document" data-name="Document">Document</a></span> syntactical grammar.</p>
<p>Lexical grammar productions in this document use lookahead restrictions to remove ambiguity and ensure a single valid lexical analysis. A lexical token is only valid if not followed by a character in its lookahead restriction.</p>
<p>In addition, lexical grammar production is sensitive to the <em>context</em>, or current state, of the lexer. Lexer context has the following properties:</p>
<ul>
<li><code>isLineStart</code>, a <code>Boolean</code> flag, which is set to <code>true</code> at the start of a new line. This property is not turned off until an encounter with a non-whitespace character.</li>
<li><code>isOperator</code>, a <code>Boolean</code> flag, which is set to <code>true</code> only within &ldquo;operator context&rdquo; (explained later).</li>
</ul>
</section>
<section id="sec-Source-Text" secid="2.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Source-Text">2.1</a></span>Source Text</h2>
<div class="spec-production d2" id="SourceCharacter">
<span class="spec-nt"><a href="#SourceCharacter" data-name="SourceCharacter">SourceCharacter</a></span><div class="spec-rhs"><span class="spec-prose">Any UTF-8 character</span></div>
</div>
<p>KTex documents are interpreted from a source text, which is a sequence of <span class="spec-nt"><a href="#SourceCharacter" data-name="SourceCharacter">SourceCharacter</a></span>, each <span class="spec-nt"><a href="#SourceCharacter" data-name="SourceCharacter">SourceCharacter</a></span> being a UTF-8 character, informally referred to as a <em>&ldquo;character&rdquo;</em> through most of this specification.</p>
<section id="sec-White-Space" secid="2.1.1">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-White-Space">2.1.1</a></span>White Space</h3>
<div class="spec-production d2" id="WhiteSpace">
<span class="spec-nt"><a href="#WhiteSpace" data-name="WhiteSpace">WhiteSpace</a></span><div class="spec-rhs"><span class="spec-condition not">isOperator</span><span class="spec-prose">Horizontal Tab (0x09)</span></div>
<div class="spec-rhs"><span class="spec-condition not">isOperator</span><span class="spec-prose">Space (0x20)</span></div>
</div>
<div class="spec-production d2" id="InsignificantWhiteSpace">
<span class="spec-nt"><a href="#InsignificantWhiteSpace" data-name="InsignificantWhiteSpace">InsignificantWhiteSpace</a></span><div class="spec-rhs"><span class="spec-condition">isOperator</span><span class="spec-prose">Horizontal Tab (0x09)</span></div>
<div class="spec-rhs"><span class="spec-condition">isOperator</span><span class="spec-prose">Space (0x20)</span></div>
</div>
<div class="spec-todo">
review this definition</div>
<p>White space is used to separate <span class="spec-nt"><span data-name="Word">Word</span></span>s and improve legibility of source text and act as separator between tokens, and any amount of white space may appear before or after any token. White space tokens usually are not significant to the semantic meaning of a KTex <span class="spec-nt"><a href="#Document" data-name="Document">Document</a></span>, however white space characters may appear within a <span class="spec-nt"><span data-name="String">String</span></span> or <span class="spec-nt"><a href="#Comment" data-name="Comment">Comment</a></span> token, and are significant within <em>&ldquo;preserving&rdquo;</em> blocks.</p>
</section>
<section id="sec-Line-Terminator" secid="2.1.2">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Line-Terminator">2.1.2</a></span>Line Terminator</h3>
<div class="spec-production d2" id="LineTerminator">
<span class="spec-nt"><a href="#LineTerminator" data-name="LineTerminator">LineTerminator</a></span><div class="spec-rhs"><span class="spec-condition not">isOperator</span><span class="spec-prose">New Line (0x0A)</span></div>
<div class="spec-rhs"><span class="spec-condition not">isOperator</span><span class="spec-prose">Carriage Return (0x0D)</span><span class="spec-lookahead not"><span class="spec-prose">New Line (0x0A)</span></span></div>
<div class="spec-rhs"><span class="spec-condition not">isOperator</span><span class="spec-prose">Carriage Return (0x0D)</span><span class="spec-prose">New Line (0x0A)</span></div>
</div>
<div class="spec-production d2" id="InsignificantLineTerminator">
<span class="spec-nt"><a href="#InsignificantLineTerminator" data-name="InsignificantLineTerminator">InsignificantLineTerminator</a></span><div class="spec-rhs"><span class="spec-condition">isOperator</span><span class="spec-prose">New Line (0x0A)</span></div>
<div class="spec-rhs"><span class="spec-condition">isOperator</span><span class="spec-prose">Carriage Return (0x0D)</span><span class="spec-lookahead not"><span class="spec-prose">New Line (0x0A)</span></span></div>
<div class="spec-rhs"><span class="spec-condition">isOperator</span><span class="spec-prose">Carriage Return (0x0D)</span><span class="spec-prose">New Line (0x0A)</span></div>
</div>
<p>Line terminators are used to split text into lines and two, or more, consecutive line terminators are treated as separators between blocks. Single line terminator is insignificant for <em>&ldquo;floating&rdquo;</em> blocks, but significant for <em>&ldquo;line-preserving&rdquo;</em> and <em>&ldquo;preserving&rdquo;</em> blocks.</p>
</section>
<section id="sec-Comment" secid="2.1.3">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Comment">2.1.3</a></span>Comment</h3>
<div class="spec-production d2" id="Comment">
<span class="spec-nt"><a href="#Comment" data-name="Comment">Comment</a></span><div class="spec-rhs"><span class="spec-nt"><a href="#CommentStart" data-name="CommentStart">CommentStart</a></span><span class="spec-quantified"><span class="spec-nt"><a href="#CommentCharacter" data-name="CommentCharacter">CommentCharacter</a></span><span class="spec-quantifiers"><span class="spec-quantifier list">list</span><span class="spec-quantifier optional">opt</span></span></span><span class="spec-lookahead ntset not"><span class="spec-nt"><a href="#CommentCharacter" data-name="CommentCharacter">CommentCharacter</a></span></span></div>
</div>
<div class="spec-production d2" id="CommentCharacter">
<span class="spec-nt"><a href="#CommentCharacter" data-name="CommentCharacter">CommentCharacter</a></span><div class="spec-rhs"><span class="spec-constrained"><span class="spec-nt"><a href="#SourceCharacter" data-name="SourceCharacter">SourceCharacter</a></span><span class="spec-butnot"><span class="spec-nt"><a href="#LineTerminator" data-name="LineTerminator">LineTerminator</a></span></span></span></div>
</div>
<div class="spec-production d2" id="CommentStart">
<span class="spec-nt"><a href="#CommentStart" data-name="CommentStart">CommentStart</a></span><div class="spec-rhs"><span class="spec-t">%</span><span class="spec-prose">when</span><span class="spec-t">context.isLineStart</span><span class="spec-prose">is</span><span class="spec-t">true</span></div>
</div>
<p>A line in KTex source documents may be transformed into a comment, by putting <span class="spec-t">%</span> marker at the start of the line. Note, that leading white space characters before the <span class="spec-t">%</span> marker does not affect the comment. But if the <span class="spec-t">%</span> marker is preceded by any number non-whitespace characters, then the <span class="spec-t">%</span> marker and the rest of the line is treated as a normal text.</p>
</section>
<section id="sec-Lexical-Tokens" secid="2.1.4">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Lexical-Tokens">2.1.4</a></span>Lexical Tokens</h3>
<div class="spec-production d2" id="Token">
<span class="spec-nt"><a href="#Token" data-name="Token">Token</a></span><div class="spec-rhs"><span class="spec-nt"><a href="#WhiteSpace" data-name="WhiteSpace">WhiteSpace</a></span></div>
<div class="spec-rhs"><span class="spec-nt"><a href="#LineTerminator" data-name="LineTerminator">LineTerminator</a></span></div>
<div class="spec-rhs"><span class="spec-nt"><span data-name="Operator">Operator</span></span></div>
<div class="spec-rhs"><span class="spec-nt"><span data-name="Punctuator">Punctuator</span></span></div>
<div class="spec-rhs"><span class="spec-nt"><span data-name="Name">Name</span></span></div>
<div class="spec-rhs"><span class="spec-nt"><span data-name="IntValue">IntValue</span></span></div>
<div class="spec-rhs"><span class="spec-nt"><span data-name="FloatValue">FloatValue</span></span></div>
<div class="spec-rhs"><span class="spec-nt"><span data-name="StringValue">StringValue</span></span></div>
<div class="spec-rhs"><span class="spec-nt"><span data-name="Word">Word</span></span></div>
<div class="spec-rhs"><span class="spec-nt"><span data-name="Punctuation">Punctuation</span></span></div>
</div>
<p>Tokens are later used as terminal symbols in KTex syntactic grammars.</p>
</section>
<section id="sec-Ignored-Tokens" secid="2.1.5">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Ignored-Tokens">2.1.5</a></span>Ignored Tokens</h3>
<div class="spec-production d2" id="Ignored">
<span class="spec-nt"><a href="#Ignored" data-name="Ignored">Ignored</a></span><div class="spec-rhs"><span class="spec-nt"><a href="#UnicodeBOM" data-name="UnicodeBOM">UnicodeBOM</a></span></div>
<div class="spec-rhs"><span class="spec-nt"><a href="#InsignificantWhiteSpace" data-name="InsignificantWhiteSpace">InsignificantWhiteSpace</a></span></div>
<div class="spec-rhs"><span class="spec-nt"><a href="#InsignificantLineTerminator" data-name="InsignificantLineTerminator">InsignificantLineTerminator</a></span></div>
<div class="spec-rhs"><span class="spec-nt"><a href="#Comment" data-name="Comment">Comment</a></span></div>
</div>
<div class="spec-production d2" id="UnicodeBOM">
<span class="spec-nt"><a href="#UnicodeBOM" data-name="UnicodeBOM">UnicodeBOM</a></span><div class="spec-rhs"><span class="spec-prose">Byte Order Mark (0xFEFF)</span></div>
</div>
</section>
</section>
<section id="sec-Operator" secid="2.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Operator">2.2</a></span>Operator</h2>
<div class="spec-todo">
</div>
</section>
<section id="sec-Document" secid="2.3">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Document">2.3</a></span>Document</h2>
<div class="spec-production d2" id="Document">
<span class="spec-nt"><a href="#Document" data-name="Document">Document</a></span><div class="spec-rhs"><span class="spec-quantified"><span class="spec-nt"><span data-name="Block">Block</span></span><span class="spec-quantifiers"><span class="spec-quantifier list">list</span></span></span></div>
</div>
</section>
</section>
<section id="index" secid="index" class="spec-index">
<h1>
<span class="spec-secid" title="link to the index"><a href="#index">§</a></span>Index</h1>
<ol>
<li><a href="#Comment">Comment</a></li>
<li><a href="#CommentCharacter">CommentCharacter</a></li>
<li><a href="#CommentStart">CommentStart</a></li>
<li><a href="#Document">Document</a></li>
<li><a href="#Ignored">Ignored</a></li>
<li><a href="#InsignificantLineTerminator">InsignificantLineTerminator</a></li>
<li><a href="#InsignificantWhiteSpace">InsignificantWhiteSpace</a></li>
<li><a href="#LineTerminator">LineTerminator</a></li>
<li><a href="#SourceCharacter">SourceCharacter</a></li>
<li><a href="#Token">Token</a></li>
<li><a href="#UnicodeBOM">UnicodeBOM</a></li>
<li><a href="#WhiteSpace">WhiteSpace</a></li>
</ol>
</section>
</article>
<footer>
Written in <a href="https://spec-md.com" target="_blank">Spec Markdown</a>.</footer>
<input hidden class="spec-sidebar-toggle" type="checkbox" id="spec-sidebar-toggle" aria-hidden /><label for="spec-sidebar-toggle" aria-hidden><div class="spec-sidebar-button">&#x2630;</div></label>
<div class="spec-sidebar" aria-hidden>
<div class="spec-toc">
<div class="title"><a href="#">KTex</a></div>
<ol><li id="_sidebar_1"><a href="#sec-Overview"><span class="spec-secid">1</span>Overview</a>
<input hidden class="toggle" type="checkbox" id="_toggle_1" /><label for="_toggle_1"></label>
<ol>
<li id="_sidebar_1.1"><a href="#sec-Design-Principles"><span class="spec-secid">1.1</span>Design Principles</a>
<input hidden class="toggle" type="checkbox" id="_toggle_1.1" /><label for="_toggle_1.1"></label>
<ol>
<li id="_sidebar_1.1.1"><a href="#sec-Single-Base"><span class="spec-secid">1.1.1</span>Single Base</a></li>
<li id="_sidebar_1.1.2"><a href="#sec-Extensibility"><span class="spec-secid">1.1.2</span>Extensibility</a></li>
<li id="_sidebar_1.1.3"><a href="#sec-Modularity"><span class="spec-secid">1.1.3</span>Modularity</a></li>
<li id="_sidebar_1.1.4"><a href="#sec-Writing-Style"><span class="spec-secid">1.1.4</span>Writing Style</a></li>
</ol>
</li>
</ol>
</li>
<li id="_sidebar_2"><a href="#sec-Language"><span class="spec-secid">2</span>Language</a>
<input hidden class="toggle" type="checkbox" id="_toggle_2" /><label for="_toggle_2"></label>
<ol>
<li id="_sidebar_2.1"><a href="#sec-Source-Text"><span class="spec-secid">2.1</span>Source Text</a>
<input hidden class="toggle" type="checkbox" id="_toggle_2.1" /><label for="_toggle_2.1"></label>
<ol>
<li id="_sidebar_2.1.1"><a href="#sec-White-Space"><span class="spec-secid">2.1.1</span>White Space</a></li>
<li id="_sidebar_2.1.2"><a href="#sec-Line-Terminator"><span class="spec-secid">2.1.2</span>Line Terminator</a></li>
<li id="_sidebar_2.1.3"><a href="#sec-Comment"><span class="spec-secid">2.1.3</span>Comment</a></li>
<li id="_sidebar_2.1.4"><a href="#sec-Lexical-Tokens"><span class="spec-secid">2.1.4</span>Lexical Tokens</a></li>
<li id="_sidebar_2.1.5"><a href="#sec-Ignored-Tokens"><span class="spec-secid">2.1.5</span>Ignored Tokens</a></li>
</ol>
</li>
<li id="_sidebar_2.2"><a href="#sec-Operator"><span class="spec-secid">2.2</span>Operator</a></li>
<li id="_sidebar_2.3"><a href="#sec-Document"><span class="spec-secid">2.3</span>Document</a></li>
</ol>
</li>
<li id="_sidebar_index"><a href="#index"><span class="spec-secid">§</span>Index</a></li>
</ol>
</div>
</div>
</body>
</html>
